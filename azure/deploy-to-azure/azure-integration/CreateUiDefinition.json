{
    "$schema": "https://schema.management.azure.com/schemas/2021-09-09/uiFormDefinition.schema.json",
        "view": {
            "kind": "Form",
            "properties": {
                "title": "Datadog Azure Integration",
                "steps": [
                    {
                        "name": "basics",
                        "label": "Basics",
                        "elements": [
                            {
                                "name": "resourceScope",
                                "type": "Microsoft.Common.ResourceScope",
                                "location": {
                                    "resourceTypes": [
                                        "microsoft.resources/resourcegroups"
                                    ]
                                }
                            },
                            {
                                "name": "ServicePrincipal",
                                "type": "Microsoft.Common.ServicePrincipalSelector",
                                "label": {
                                    "password": "Password",
                                    "sectionHeader": "Service Principal"
                                },
                                "toolTip": {
                                    "password": "Password"
                                },
                                "defaultValue": {
                                    "principalId": "<default guid>",
                                    "name": "(New) default App Id"
                                },
                                "constraints": {
                                    "required": true,
                                    "regex": "^[a-zA-Z0-9]{8,}$",
                                    "validationMessage": "Password must be at least 8 characters long, contain only numbers and letters"
                                },
                                "options": {
                                    "hideCertificate": true
                                },
                                "visible": true
                            },
                            {
                                "name": "datadogApplicationKey",
                                "type": "Microsoft.Common.PasswordBox",
                                "label": {
                                    "password": "Datadog Application key",
                                    "confirmPassword": "Datadog Application key"
                                },
                                "toolTip": "Your Datadog Application key",
                                "constraints": {
                                    "required": true,
                                    "regex": "",
                                    "validationMessage": ""
                                },
                                "options": {
                                    "hideConfirmation": true
                                },
                                "visible": true
                            },
                            {
                                "name": "datadogApiKey",
                                "type": "Microsoft.Common.PasswordBox",
                                "label": {
                                    "password": "Datadog API key",
                                    "confirmPassword": "Datadog API key"
                                },
                                "toolTip": "Your datadog API key",
                                "constraints": {
                                    "required": true,
                                    "regex": "",
                                    "validationMessage": ""
                                },
                                "options": {
                                    "hideConfirmation": true
                                },
                                "visible": true
                            },
                            {
                                "name": "hostFilters",
                                "type": "Microsoft.Common.TextBox",
                                "label": "Host filters",
                                "defaultValue": "",
                                "toolTip": "Filter to include/exclude hosts",
                                "constraints": {
                                    "required": false,
                                    "regex": "",
                                    "validationMessage": ""
                                },
                                "visible": true
                            },
                            {
                                "name": "automute",
                                "type": "Microsoft.Common.DropDown",
                                "label": "Automute",
                                "defaultValue": "true",
                                "toolTip": "Whether or not to use automute for hosts",
                                "constraints": {
                                    "required": false,
                                    "allowedValues": [
                                        {
                                            "label": "true",
                                            "value": true
                                        },
                                        {
                                            "label": "false",
                                            "value": false
                                        }
                                    ]
                                },
                                "visible": true
                            },
                            {
                                "name": "datadogSite",
                                "type": "Microsoft.Common.TextBox",
                                "label": "Datadog site",
                                "defaultValue": "datadoghq.com",
                                "toolTip": "The Datadog site, e.g. eu1.datadoghq.com",
                                "constraints": {
                                    "required": true,
                                    "regex": "",
                                    "validationMessage": ""
                                },
                                "visible": true
                            },
                            {
                                "name": "providersApi",
                                "type": "Microsoft.Solutions.ArmApiControl",
                                "request": {
                                  "method": "GET",
                                  "path": "subscriptions?api-version=2020-01-01"
                                }
                              },
                              {
                                "name": "providerDropDown",
                                "type": "Microsoft.Common.DropDown",
                                "label": "Subscriptions",
                                "toolTip": "The subscriptions to monitor",
                                "multiselect": true,
                                "constraints": {
                                  "allowedValues": "[map(basics('providersApi').value, (item) => parse(concat('{\"label\":\"', item.displayName, '\",\"value\":\"', item.id, '\"}')))]",
                                  "required": true
                                },
                                "visible": true
                              }
                        ]
                    }
                ]
            },
            "outputs": {
                "parameters": {
                    "servicePrincipalId": "[steps('basics').ServicePrincipal.appId]",
                    "servicePrincipalSecret": "[steps('basics').ServicePrincipal.password]",
                    "datadogApplicationKey": "[steps('basics').datadogApplicationKey]",
                    "datadogApiKey": "[steps('basics').datadogApiKey]",
                    "hostFilters": "[steps('basics').hostFilters]",
                    "automute": "[steps('basics').automute]",
                    "datadogSite": "[steps('basics').datadogSite]"
                },
                "kind": "Subscription",
                "location": "[steps('basics').resourceScope.location.name]",
                "subscriptionId": "[steps('basics').resourceScope.subscription.id]"
            }
        }
}
